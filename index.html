<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>حمزة يضرب اخواته</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #1a1a2e; min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; font-family: sans-serif; color: #eee; }
        h1 { margin-bottom: 10px; font-size: 1.5rem; }
        #gameCanvas { background: #16213e; border: 3px solid #0f3460; border-radius: 8px; display: block; cursor: none; }
        .info { margin-top: 10px; font-size: 14px; color: #aaa; }
        .info kbd { background: #333; padding: 2px 6px; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>حمزة يضرب اخواته</h1>
    <canvas id="gameCanvas" width="800" height="500"></canvas>
    <p class="info">Move: mouse or <kbd>A</kbd>/<kbd>D</kbd> | Headbutt: click or <kbd>Space</kbd></p>
    <script>
(function() {
    var canvas = document.getElementById('gameCanvas');
    var ctx = canvas.getContext('2d');
    var W = canvas.width;
    var H = canvas.height;
    var player = { x: W / 2 - 35, y: H - 110, w: 70, h: 100, vx: 0, headbutting: false, headbuttFrame: 0 };
    var npcs = [];
    var score = 0;
    var gameOver = false;
    var spawnTimer = 0;
    var keys = {};
    var HEADBUTT_DURATION = 12;
    var HEADBUTT_RANGE = 90;
    var GAME_DURATION = 30;
    var gameStartTime = null;
    var imgPlayer = null;
    var imgNpc = null;
    var IMAGE_NAMES = { player: 'Screenshot 2026-02-08 015945', playerExt: 'png', npc: 'WhatsApp Image 2026-02-08 at 2.06.37 AM', npcExt: 'jpeg' };
    var mouseX = null;

    function loadImage(path, callback) {
        var img = new Image();
        img.onload = function() { callback(img); };
        img.onerror = function() { callback(null); };
        img.src = path;
    }

    function loadAllImages(done) {
        var count = 0;
        function check() { count++; if (count >= 2) done(); }
        loadImage('images/' + IMAGE_NAMES.player + '.' + IMAGE_NAMES.playerExt, function(img) { imgPlayer = img; check(); });
        loadImage('images/' + IMAGE_NAMES.npc + '.' + IMAGE_NAMES.npcExt, function(img) { imgNpc = img; check(); });
    }

    function spawnNpc() {
        npcs.push({ x: Math.random() * (W - 50), y: -60, w: 50, h: 70, vx: (Math.random() - 0.5) * 2, hit: false });
    }

    function gameLoop() {
        if (gameStartTime === null) gameStartTime = Date.now();
        var elapsed = (Date.now() - gameStartTime) / 1000;
        if (gameOver) {
            ctx.fillStyle = 'rgba(0,0,0,0.7)';
            ctx.fillRect(0, 0, W, H);
            ctx.fillStyle = '#e74c3c';
            ctx.font = 'bold 48px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText("Time's up!", W / 2, H / 2 - 30);
            ctx.fillStyle = '#fff';
            ctx.font = '24px sans-serif';
            ctx.fillText('Score: ' + score, W / 2, H / 2 + 20);
            ctx.fillText('Refresh to play again', W / 2, H / 2 + 55);
            requestAnimationFrame(gameLoop);
            return;
        }
        if (elapsed >= GAME_DURATION) { gameOver = true; requestAnimationFrame(gameLoop); return; }
        ctx.fillStyle = '#16213e';
        ctx.fillRect(0, 0, W, H);
        ctx.strokeStyle = '#0f3460';
        ctx.lineWidth = 2;
        ctx.strokeRect(0, 0, W, H);

        spawnTimer++;
        if (spawnTimer > 25) { spawnTimer = 0; spawnNpc(); }

        for (var i = npcs.length - 1; i >= 0; i--) {
            var n = npcs[i];
            if (n.hit) { npcs.splice(i, 1); continue; }
            n.x += n.vx;
            n.y += 1.8;
            if (n.x < 0 || n.x > W - n.w) n.vx *= -1;
            var hbx = player.x + player.w / 2;
            var hby = player.y;
            if (player.headbutting && Math.abs(hbx - (n.x + n.w / 2)) < HEADBUTT_RANGE && Math.abs(hby - n.y) < 80) {
                n.hit = true;
                score++;
            }
            if (imgNpc) {
                var iw = imgNpc.naturalWidth, ih = imgNpc.naturalHeight;
                var scale = Math.min(n.w / iw, n.h / ih);
                var dw = iw * scale, dh = ih * scale;
                ctx.drawImage(imgNpc, 0, 0, iw, ih, n.x + (n.w - dw) / 2, n.y + (n.h - dh) / 2, dw, dh);
            } else {
                ctx.fillStyle = '#3498db';
                ctx.fillRect(n.x, n.y, n.w, n.h);
                ctx.fillStyle = '#2980b9';
                ctx.fillRect(n.x + 5, n.y + 5, 10, 10);
            }
        }

        if (mouseX !== null) {
            player.x = Math.max(0, Math.min(W - player.w, mouseX - player.w / 2));
        } else {
            if (keys['ArrowLeft'] || keys['a']) player.vx = -6;
            else if (keys['ArrowRight'] || keys['d']) player.vx = 6;
            else player.vx = 0;
            player.x += player.vx;
            if (player.x < 0) player.x = 0;
            if (player.x > W - player.w) player.x = W - player.w;
        }

        if (player.headbutting) {
            player.headbuttFrame++;
            if (player.headbuttFrame >= HEADBUTT_DURATION) {
                player.headbutting = false;
                player.headbuttFrame = 0;
            }
        } else if (keys[' ']) {
            player.headbutting = true;
            player.headbuttFrame = 0;
        }

        var drawY = player.y;
        if (player.headbutting) drawY -= Math.min(player.headbuttFrame * 4, 40);
        if (imgPlayer) {
            var iw = imgPlayer.naturalWidth, ih = imgPlayer.naturalHeight;
            var scale = Math.min(player.w / iw, player.h / ih);
            var dw = iw * scale, dh = ih * scale;
            ctx.drawImage(imgPlayer, 0, 0, iw, ih, player.x + (player.w - dw) / 2, drawY + (player.h - dh) / 2, dw, dh);
        }
        else {
            ctx.fillStyle = '#e67e22';
            ctx.fillRect(player.x, player.y, player.w, player.h);
            ctx.fillStyle = '#d35400';
            ctx.fillRect(player.x + 10, player.y, 12, 15);
            if (player.headbutting) {
                ctx.fillStyle = '#c0392b';
                var lunge = Math.min(player.headbuttFrame * 4, 35);
                ctx.fillRect(player.x + player.w / 2 - 8, player.y - lunge, 16, 20);
            }
        }

        ctx.fillStyle = '#fff';
        ctx.font = 'bold 20px sans-serif';
        ctx.textAlign = 'left';
        ctx.fillText('Score: ' + score, 15, 30);
        var left = Math.ceil(GAME_DURATION - elapsed);
        ctx.textAlign = 'right';
        ctx.fillText('Time: ' + (left > 0 ? left : 0), W - 15, 30);
        ctx.textAlign = 'left';
        requestAnimationFrame(gameLoop);
    }

    document.addEventListener('keydown', function(e) { keys[e.key.toLowerCase()] = true; if (e.key === ' ') e.preventDefault(); });
    document.addEventListener('keyup', function(e) { keys[e.key.toLowerCase()] = false; });
    canvas.addEventListener('mousemove', function(e) {
        var rect = canvas.getBoundingClientRect();
        var x = e.clientX - rect.left;
        mouseX = (x >= 0 && x <= W) ? x * (canvas.width / rect.width) : null;
    });
    canvas.addEventListener('mouseleave', function() { mouseX = null; });
    canvas.addEventListener('mousedown', function() {
        if (!gameOver && !player.headbutting) { player.headbutting = true; player.headbuttFrame = 0; }
    });
    loadAllImages(function() { gameStartTime = null; requestAnimationFrame(gameLoop); });
})();
    </script>
</body>
</html>
